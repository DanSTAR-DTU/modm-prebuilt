!!! warning "These module docs are in beta and may be incomplete."

# modm:cmsis:device: STM32 CMSIS Headers

This module wraps [the CMSIS headers for STM32 devices][repo] and provides the
header file and CPP definitions for accessing the `modm:target` peripherals.
Specifically, it copies the target header file which provides the CMSIS
implementation of the target's language interface for its memory-mapped
peripherals.

!!! bug "Discrepancies between documentation and headers"
    These CMSIS headers should reflect what's written in the documentation,
    however, in our experience there may be small differences in naming,
    behavior and availability between it and this implementation.
    Since ST is not interested in addressing these issues, please contribute
	[to our patch list][patches].

The generated header file `modm/platform/device.hpp` contains the necessary
target define `STM32{FAMILY}{NAME}xx` or similar and includes the
`modm:target`-specific header.

!!! tip "Include only `modm/platform/device.hpp`!"
	This file is only included by interface implementations inside the
	`modm/platform` folder! If you need to implement your own drivers, include
	only this file.


## CMSIS Compliance

modm implements the target specific CMSIS functionality itself, without using
the CMSIS interface. This is necessary to provide similar functionality on
non-Cortex-M based targets.

Specifically, these functions are not implemented:

- `uint32_t SystemCoreClock` and `void SystemCoreClockUpdate()`: please use
  `modm::clock::f_cpu` as defined in the `modm:architecture:clock` module.
- `void SystemInit()`: modm defines its own startup architecture, see the
  `modm:platform:core` module for details.


[repo]: https://github.com/modm-io/cmsis-header-stm32
[patches]: https://github.com/modm-io/cmsis-header-stm32/tree/master/patches


## Debugging Peripherals

When debugging with GDB, it can sometimes be difficult to access peripherals,
due to the CMSIS implementation with CPP defines and GCC optimization flags.
Depending on these circumstances, GDB may only "see" a peripheral in a certain
context, which can make the debugging experience quite frustrating.

To aid this, we generate a linkerscript fragment and source file, which place
the peripherals memory as real objects in the peripheral memory space.
You can then access these peripherals inside GDB at any time, regardless of
context and build profile setting:

```
(gdb) p/x *GPIOB
$1 = {
  MODER = 0xaa0280,
  OTYPER = 0x300,
  OSPEEDR = 0x2a00c0,
  PUPDR = 0x400100,
  IDR = 0xfd0,
  ODR = 0x100,
  BSRR = 0x0,
  LCKR = 0x0,
  AFR = {0x0, 0x7744}
}
```

**This does not have any effect on your firmware!** It is purely a debug
helper feature and none of these definitions make it into the executable.

!!! tip "Beware read/write side-effects"
    When debugging be aware of the side-effects that your read or write to a
    peripheral memory location can have. It's fairly obvious that a write may
    have consequences, but also reads can modify peripheral state, for example,
    a hardware FIFO buffer may pop the queue if your read the top of it.

## Content

```cpp
// Define
#define STM32F446xx
```
## Queries
#### rcc-map

None
## Dependencies

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (0)
 -->
<!-- Title: modm:cmsis:device Pages: 1 -->
<svg width="1000pt" height="239pt"
 viewBox="0.00 0.00 1000.00 239.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 235)">
<title>modm:cmsis:device</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-235 996,-235 996,4 -4,4"/>
<!-- modm_cmsis_device -->
<g id="node1" class="node">
<title>modm_cmsis_device</title>
<polygon fill="#d3d3d3" stroke="#000000" stroke-width="2" points="528,-142 463,-142 463,-89 528,-89 528,-142"/>
<text text-anchor="middle" x="495.5" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="495.5" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="495.5" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#000000">device</text>
</g>
<!-- modm_cmsis -->
<g id="node2" class="node">
<title>modm_cmsis</title>
<g id="a_node2"><a xlink:href="../modm-cmsis" xlink:title="modm:&#10;cmsis">
<polygon fill="#d3d3d3" stroke="#000000" points="487,-223.5 422,-223.5 422,-185.5 487,-185.5 487,-223.5"/>
<text text-anchor="middle" x="454.5" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="454.5" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis -->
<g id="edge1" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis</title>
<path fill="none" stroke="#000000" d="M483.1986,-142.2029C478.2364,-152.9746 472.5069,-165.4119 467.4783,-176.3275"/>
<polygon fill="#000000" stroke="#000000" points="464.2819,-174.9012 463.2767,-185.4482 470.6397,-177.8301 464.2819,-174.9012"/>
</g>
<!-- modm_cmsis_core -->
<g id="node3" class="node">
<title>modm_cmsis_core</title>
<g id="a_node3"><a xlink:href="../modm-cmsis-core" xlink:title="modm:&#10;cmsis:&#10;core">
<polygon fill="#d3d3d3" stroke="#000000" points="570,-231 505,-231 505,-178 570,-178 570,-231"/>
<text text-anchor="middle" x="537.5" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="537.5" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="537.5" y="-185.8" font-family="Times,serif" font-size="14.00" fill="#000000">core</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis_core -->
<g id="edge2" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis_core</title>
<path fill="none" stroke="#000000" d="M508.1014,-142.2029C512.0052,-150.4753 516.3726,-159.73 520.5223,-168.5235"/>
<polygon fill="#000000" stroke="#000000" points="517.4744,-170.2661 524.9075,-177.8159 523.805,-167.2786 517.4744,-170.2661"/>
</g>
<!-- modm_platform_adc -->
<g id="node4" class="node">
<title>modm_platform_adc</title>
<g id="a_node4"><a xlink:href="../modm-platform-adc" xlink:title="modm:&#10;platform:&#10;adc">
<polygon fill="#d3d3d3" stroke="#000000" points="83,-53 0,-53 0,0 83,0 83,-53"/>
<text text-anchor="middle" x="41.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="41.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="41.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">adc</text>
</a>
</g>
</g>
<!-- modm_platform_adc&#45;&gt;modm_cmsis_device -->
<g id="edge3" class="edge">
<title>modm_platform_adc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M83.0607,-49.8231C85.8744,-50.997 88.7027,-52.0717 91.5,-53 218.7223,-95.2198 378.1188,-109.1615 452.9699,-113.5703"/>
<polygon fill="#000000" stroke="#000000" points="452.778,-117.0649 462.9585,-114.131 453.1704,-110.0759 452.778,-117.0649"/>
</g>
<!-- modm_platform_can -->
<g id="node5" class="node">
<title>modm_platform_can</title>
<g id="a_node5"><a xlink:href="../modm-platform-can" xlink:title="modm:&#10;platform:&#10;can">
<polygon fill="#d3d3d3" stroke="#000000" points="184,-53 101,-53 101,0 184,0 184,-53"/>
<text text-anchor="middle" x="142.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="142.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="142.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">can</text>
</a>
</g>
</g>
<!-- modm_platform_can&#45;&gt;modm_cmsis_device -->
<g id="edge4" class="edge">
<title>modm_platform_can&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M184.1169,-49.6605C186.9168,-50.8743 189.7267,-52.0022 192.5,-53 282.1328,-85.2509 392.9969,-102.8127 452.6565,-110.5595"/>
<polygon fill="#000000" stroke="#000000" points="452.4723,-114.064 462.8331,-111.8497 453.3528,-107.1196 452.4723,-114.064"/>
</g>
<!-- modm_platform_cortex_m -->
<g id="node6" class="node">
<title>modm_platform_cortex_m</title>
<g id="a_node6"><a xlink:href="../modm-platform-cortex-m" xlink:title="modm:&#10;platform:&#10;cortex&#45;m">
<polygon fill="#d3d3d3" stroke="#000000" points="285,-53 202,-53 202,0 285,0 285,-53"/>
<text text-anchor="middle" x="243.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="243.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="243.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">cortex&#45;m</text>
</a>
</g>
</g>
<!-- modm_platform_cortex_m&#45;&gt;modm_cmsis_device -->
<g id="edge5" class="edge">
<title>modm_platform_cortex_m&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M285.2372,-49.35C288.0076,-50.6398 290.7782,-51.8694 293.5,-53 347.0552,-75.2468 411.435,-93.837 452.8862,-104.8119"/>
<polygon fill="#000000" stroke="#000000" points="452.0925,-108.222 462.653,-107.3691 453.8656,-101.4503 452.0925,-108.222"/>
</g>
<!-- modm_platform_gpio -->
<g id="node7" class="node">
<title>modm_platform_gpio</title>
<g id="a_node7"><a xlink:href="../modm-platform-gpio" xlink:title="modm:&#10;platform:&#10;gpio">
<polygon fill="#d3d3d3" stroke="#000000" points="386,-53 303,-53 303,0 386,0 386,-53"/>
<text text-anchor="middle" x="344.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="344.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="344.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">gpio</text>
</a>
</g>
</g>
<!-- modm_platform_gpio&#45;&gt;modm_cmsis_device -->
<g id="edge6" class="edge">
<title>modm_platform_gpio&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M386.1611,-51.0552C407.2429,-63.4809 432.7629,-78.5225 453.8439,-90.9478"/>
<polygon fill="#000000" stroke="#000000" points="452.1889,-94.0349 462.581,-96.0974 455.7433,-88.0045 452.1889,-94.0349"/>
</g>
<!-- modm_platform_i2c -->
<g id="node8" class="node">
<title>modm_platform_i2c</title>
<g id="a_node8"><a xlink:href="../modm-platform-i2c" xlink:title="modm:&#10;platform:&#10;i2c">
<polygon fill="#d3d3d3" stroke="#000000" points="487,-53 404,-53 404,0 487,0 487,-53"/>
<text text-anchor="middle" x="445.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="445.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="445.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">i2c</text>
</a>
</g>
</g>
<!-- modm_platform_i2c&#45;&gt;modm_cmsis_device -->
<g id="edge7" class="edge">
<title>modm_platform_i2c&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M460.5016,-53.2029C465.2479,-61.6513 470.5698,-71.1243 475.6034,-80.0841"/>
<polygon fill="#000000" stroke="#000000" points="472.5595,-81.8118 480.5089,-88.8159 478.6624,-78.3832 472.5595,-81.8118"/>
</g>
<!-- modm_platform_rcc -->
<g id="node9" class="node">
<title>modm_platform_rcc</title>
<g id="a_node9"><a xlink:href="../modm-platform-rcc" xlink:title="modm:&#10;platform:&#10;rcc">
<polygon fill="#d3d3d3" stroke="#000000" points="588,-53 505,-53 505,0 588,0 588,-53"/>
<text text-anchor="middle" x="546.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="546.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="546.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">rcc</text>
</a>
</g>
</g>
<!-- modm_platform_rcc&#45;&gt;modm_cmsis_device -->
<g id="edge8" class="edge">
<title>modm_platform_rcc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M531.1983,-53.2029C526.3571,-61.6513 520.9288,-71.1243 515.7945,-80.0841"/>
<polygon fill="#000000" stroke="#000000" points="512.7261,-78.3993 510.7909,-88.8159 518.7996,-81.8796 512.7261,-78.3993"/>
</g>
<!-- modm_platform_spi -->
<g id="node10" class="node">
<title>modm_platform_spi</title>
<g id="a_node10"><a xlink:href="../modm-platform-spi" xlink:title="modm:&#10;platform:&#10;spi">
<polygon fill="#d3d3d3" stroke="#000000" points="689,-53 606,-53 606,0 689,0 689,-53"/>
<text text-anchor="middle" x="647.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="647.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="647.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">spi</text>
</a>
</g>
</g>
<!-- modm_platform_spi&#45;&gt;modm_cmsis_device -->
<g id="edge9" class="edge">
<title>modm_platform_spi&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M605.9653,-50.8196C584.5838,-63.3391 558.585,-78.5621 537.1823,-91.0939"/>
<polygon fill="#000000" stroke="#000000" points="535.179,-88.211 528.318,-96.2842 538.716,-94.2517 535.179,-88.211"/>
</g>
<!-- modm_platform_systick -->
<g id="node11" class="node">
<title>modm_platform_systick</title>
<g id="a_node11"><a xlink:href="../modm-platform-systick" xlink:title="modm:&#10;platform:&#10;systick">
<polygon fill="#d3d3d3" stroke="#000000" points="790,-53 707,-53 707,0 790,0 790,-53"/>
<text text-anchor="middle" x="748.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="748.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="748.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">systick</text>
</a>
</g>
</g>
<!-- modm_platform_systick&#45;&gt;modm_cmsis_device -->
<g id="edge10" class="edge">
<title>modm_platform_systick&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M706.7647,-49.3544C703.9937,-50.6431 701.2226,-51.8713 698.5,-53 644.5299,-75.3751 579.6085,-93.9939 537.9632,-104.9356"/>
<polygon fill="#000000" stroke="#000000" points="536.9546,-101.5814 528.1559,-107.4833 538.7146,-108.3565 536.9546,-101.5814"/>
</g>
<!-- modm_platform_timer -->
<g id="node12" class="node">
<title>modm_platform_timer</title>
<g id="a_node12"><a xlink:href="../modm-platform-timer" xlink:title="modm:&#10;platform:&#10;timer">
<polygon fill="#d3d3d3" stroke="#000000" points="891,-53 808,-53 808,0 891,0 891,-53"/>
<text text-anchor="middle" x="849.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="849.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="849.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">timer</text>
</a>
</g>
</g>
<!-- modm_platform_timer&#45;&gt;modm_cmsis_device -->
<g id="edge11" class="edge">
<title>modm_platform_timer&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M807.8838,-49.6626C805.0838,-50.8758 802.2736,-52.0031 799.5,-53 709.5729,-85.3237 598.3423,-102.8575 538.4854,-110.5801"/>
<polygon fill="#000000" stroke="#000000" points="537.7592,-107.1438 528.275,-111.8661 538.634,-114.0889 537.7592,-107.1438"/>
</g>
<!-- modm_platform_uart -->
<g id="node13" class="node">
<title>modm_platform_uart</title>
<g id="a_node13"><a xlink:href="../modm-platform-uart" xlink:title="modm:&#10;platform:&#10;uart">
<polygon fill="#d3d3d3" stroke="#000000" points="992,-53 909,-53 909,0 992,0 992,-53"/>
<text text-anchor="middle" x="950.5" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="950.5" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="950.5" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">uart</text>
</a>
</g>
</g>
<!-- modm_platform_uart&#45;&gt;modm_cmsis_device -->
<g id="edge12" class="edge">
<title>modm_platform_uart&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M908.9397,-49.8243C906.1259,-50.998 903.2975,-52.0722 900.5,-53 772.9623,-95.298 613.1715,-109.2026 538.1352,-113.5864"/>
<polygon fill="#000000" stroke="#000000" points="537.912,-110.0933 528.122,-114.1438 538.3011,-117.0825 537.912,-110.0933"/>
</g>
</g>
</svg>

