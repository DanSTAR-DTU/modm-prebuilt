!!! warning "These module docs are in beta and may be incomplete."

# modm:cmsis:device: STM32 CMSIS Headers

This module wraps [the CMSIS headers for STM32 devices][repo] and provides the
header file and CPP definitions for accessing the `modm:target` peripherals.
Specifically, it copies the target header file which provides the CMSIS
implementation of the target's language interface for its memory-mapped
peripherals.

!!! bug "Discrepancies between documentation and headers"
    These CMSIS headers should reflect what's written in the documentation,
    however, in our experience there may be small differences in naming,
    behavior and availability between it and this implementation.
    Since ST is not interested in addressing these issues, please contribute
	[to our patch list][patches].

The generated header file `modm/platform/device.hpp` contains the necessary
target define `STM32{FAMILY}{NAME}xx` or similar and includes the
`modm:target`-specific header.

!!! tip "Include only `modm/platform/device.hpp`!"
	This file is only included by interface implementations inside the
	`modm/platform` folder! If you need to implement your own drivers, include
	only this file.


## CMSIS Compliance

modm implements the target specific CMSIS functionality itself, without using
the CMSIS interface. This is necessary to provide similar functionality on
non-Cortex-M based targets.

Specifically, these functions are not implemented:

- `uint32_t SystemCoreClock` and `void SystemCoreClockUpdate()`: please use
  `modm::clock::f_cpu` as defined in the `modm:architecture:clock` module.
- `void SystemInit()`: modm defines its own startup architecture, see the
  `modm:platform:core` module for details.


[repo]: https://github.com/modm-io/cmsis-header-stm32
[patches]: https://github.com/modm-io/cmsis-header-stm32/tree/master/patches


## Debugging Peripherals

When debugging with GDB, it can sometimes be difficult to access peripherals,
due to the CMSIS implementation with CPP defines and GCC optimization flags.
Depending on these circumstances, GDB may only "see" a peripheral in a certain
context, which can make the debugging experience quite frustrating.

To aid this, we generate a linkerscript fragment and source file, which place
the peripherals memory as real objects in the peripheral memory space.
You can then access these peripherals inside GDB at any time, regardless of
context and build profile setting:

```
(gdb) p/x *GPIOB
$1 = {
  MODER = 0xaa0280,
  OTYPER = 0x300,
  OSPEEDR = 0x2a00c0,
  PUPDR = 0x400100,
  IDR = 0xfd0,
  ODR = 0x100,
  BSRR = 0x0,
  LCKR = 0x0,
  AFR = {0x0, 0x7744}
}
```

**This does not have any effect on your firmware!** It is purely a debug
helper feature and none of these definitions make it into the executable.

!!! tip "Beware read/write side-effects"
    When debugging be aware of the side-effects that your read or write to a
    peripheral memory location can have. It's fairly obvious that a write may
    have consequences, but also reads can modify peripheral state, for example,
    a hardware FIFO buffer may pop the queue if your read the top of it.

## Content

```cpp
// Define
#define STM32F446xx
```
## Queries
#### rcc-map

None
## Dependencies

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: modm:cmsis:device Pages: 1 -->
<svg width="850pt" height="239pt"
 viewBox="0.00 0.00 850.00 239.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 235)">
<title>modm:cmsis:device</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-235 846,-235 846,4 -4,4"/>
<!-- modm_cmsis_device -->
<g id="node1" class="node">
<title>modm_cmsis_device</title>
<polygon fill="#d3d3d3" stroke="#000000" stroke-width="2" points="449,-142 393,-142 393,-89 449,-89 449,-142"/>
<text text-anchor="middle" x="421" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="421" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="421" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#000000">device</text>
</g>
<!-- modm_cmsis -->
<g id="node2" class="node">
<title>modm_cmsis</title>
<g id="a_node2"><a xlink:href="../modm-cmsis" xlink:title="modm:&#10;cmsis">
<polygon fill="#d3d3d3" stroke="#000000" points="412,-223.5 356,-223.5 356,-185.5 412,-185.5 412,-223.5"/>
<text text-anchor="middle" x="384" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="384" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis -->
<g id="edge1" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis</title>
<path fill="none" stroke="#000000" d="M409.8988,-142.2029C405.4659,-152.8658 400.3545,-165.1608 395.8498,-175.9963"/>
<polygon fill="#000000" stroke="#000000" points="392.5274,-174.8708 391.9204,-185.4482 398.9911,-177.558 392.5274,-174.8708"/>
</g>
<!-- modm_cmsis_core -->
<g id="node3" class="node">
<title>modm_cmsis_core</title>
<g id="a_node3"><a xlink:href="../modm-cmsis-core" xlink:title="modm:&#10;cmsis:&#10;core">
<polygon fill="#d3d3d3" stroke="#000000" points="486,-231 430,-231 430,-178 486,-178 486,-231"/>
<text text-anchor="middle" x="458" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="458" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="458" y="-185.8" font-family="Times,serif" font-size="14.00" fill="#000000">core</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis_core -->
<g id="edge2" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis_core</title>
<path fill="none" stroke="#000000" d="M432.1012,-142.2029C435.5403,-150.4753 439.3878,-159.73 443.0435,-168.5235"/>
<polygon fill="#000000" stroke="#000000" points="439.8359,-169.9257 446.9066,-177.8159 446.2996,-167.2385 439.8359,-169.9257"/>
</g>
<!-- modm_platform_adc -->
<g id="node4" class="node">
<title>modm_platform_adc</title>
<g id="a_node4"><a xlink:href="../modm-platform-adc" xlink:title="modm:&#10;platform:&#10;adc">
<polygon fill="#d3d3d3" stroke="#000000" points="68,-53 0,-53 0,0 68,0 68,-53"/>
<text text-anchor="middle" x="34" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="34" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="34" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">adc</text>
</a>
</g>
</g>
<!-- modm_platform_adc&#45;&gt;modm_cmsis_device -->
<g id="edge3" class="edge">
<title>modm_platform_adc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M68.1571,-49.072C71.0832,-50.5341 74.0522,-51.8702 77,-53 183.0383,-93.6429 317.8108,-108.2614 382.6878,-113.1867"/>
<polygon fill="#000000" stroke="#000000" points="382.6296,-116.6916 392.856,-113.922 383.1345,-109.7098 382.6296,-116.6916"/>
</g>
<!-- modm_platform_can -->
<g id="node5" class="node">
<title>modm_platform_can</title>
<g id="a_node5"><a xlink:href="../modm-platform-can" xlink:title="modm:&#10;platform:&#10;can">
<polygon fill="#d3d3d3" stroke="#000000" points="154,-53 86,-53 86,0 154,0 154,-53"/>
<text text-anchor="middle" x="120" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="120" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="120" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">can</text>
</a>
</g>
</g>
<!-- modm_platform_can&#45;&gt;modm_cmsis_device -->
<g id="edge4" class="edge">
<title>modm_platform_can&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M154.2324,-48.8839C157.1416,-50.3881 160.0862,-51.7853 163,-53 237.818,-84.1913 331.6128,-102.0248 382.9924,-110.1321"/>
<polygon fill="#000000" stroke="#000000" points="382.5715,-113.6085 392.9876,-111.6705 383.6364,-106.6899 382.5715,-113.6085"/>
</g>
<!-- modm_platform_cortex_m -->
<g id="node6" class="node">
<title>modm_platform_cortex_m</title>
<g id="a_node6"><a xlink:href="../modm-platform-cortex-m" xlink:title="modm:&#10;platform:&#10;cortex&#45;m">
<polygon fill="#d3d3d3" stroke="#000000" points="240,-53 172,-53 172,0 240,0 240,-53"/>
<text text-anchor="middle" x="206" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="206" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="206" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">cortex&#45;m</text>
</a>
</g>
</g>
<!-- modm_platform_cortex_m&#45;&gt;modm_cmsis_device -->
<g id="edge5" class="edge">
<title>modm_platform_cortex_m&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M240.3914,-48.5303C243.2649,-50.1138 246.158,-51.6257 249,-53 293.5163,-74.5269 347.4777,-92.9796 382.9461,-104.1396"/>
<polygon fill="#000000" stroke="#000000" points="382.2939,-107.6019 392.8821,-107.2272 384.3712,-100.9173 382.2939,-107.6019"/>
</g>
<!-- modm_platform_gpio -->
<g id="node7" class="node">
<title>modm_platform_gpio</title>
<g id="a_node7"><a xlink:href="../modm-platform-gpio" xlink:title="modm:&#10;platform:&#10;gpio">
<polygon fill="#d3d3d3" stroke="#000000" points="326,-53 258,-53 258,0 326,0 326,-53"/>
<text text-anchor="middle" x="292" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="292" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="292" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">gpio</text>
</a>
</g>
</g>
<!-- modm_platform_gpio&#45;&gt;modm_cmsis_device -->
<g id="edge6" class="edge">
<title>modm_platform_gpio&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M326.231,-50.1167C344.0635,-62.4198 365.8881,-77.4771 384.0967,-90.0396"/>
<polygon fill="#000000" stroke="#000000" points="382.4929,-93.1852 392.7116,-95.9832 386.4681,-87.4234 382.4929,-93.1852"/>
</g>
<!-- modm_platform_i2c -->
<g id="node8" class="node">
<title>modm_platform_i2c</title>
<g id="a_node8"><a xlink:href="../modm-platform-i2c" xlink:title="modm:&#10;platform:&#10;i2c">
<polygon fill="#d3d3d3" stroke="#000000" points="412,-53 344,-53 344,0 412,0 412,-53"/>
<text text-anchor="middle" x="378" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="378" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="378" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">i2c</text>
</a>
</g>
</g>
<!-- modm_platform_i2c&#45;&gt;modm_cmsis_device -->
<g id="edge7" class="edge">
<title>modm_platform_i2c&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M390.9014,-53.2029C394.9407,-61.5633 399.4648,-70.927 403.7536,-79.8039"/>
<polygon fill="#000000" stroke="#000000" points="400.6059,-81.3344 408.1077,-88.8159 406.9088,-78.2891 400.6059,-81.3344"/>
</g>
<!-- modm_platform_rcc -->
<g id="node9" class="node">
<title>modm_platform_rcc</title>
<g id="a_node9"><a xlink:href="../modm-platform-rcc" xlink:title="modm:&#10;platform:&#10;rcc">
<polygon fill="#d3d3d3" stroke="#000000" points="498,-53 430,-53 430,0 498,0 498,-53"/>
<text text-anchor="middle" x="464" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="464" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="464" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">rcc</text>
</a>
</g>
</g>
<!-- modm_platform_rcc&#45;&gt;modm_cmsis_device -->
<g id="edge8" class="edge">
<title>modm_platform_rcc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M451.0986,-53.2029C447.0593,-61.5633 442.5352,-70.927 438.2464,-79.8039"/>
<polygon fill="#000000" stroke="#000000" points="435.0912,-78.2891 433.8923,-88.8159 441.3941,-81.3344 435.0912,-78.2891"/>
</g>
<!-- modm_platform_spi -->
<g id="node10" class="node">
<title>modm_platform_spi</title>
<g id="a_node10"><a xlink:href="../modm-platform-spi" xlink:title="modm:&#10;platform:&#10;spi">
<polygon fill="#d3d3d3" stroke="#000000" points="584,-53 516,-53 516,0 584,0 584,-53"/>
<text text-anchor="middle" x="550" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="550" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="550" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">spi</text>
</a>
</g>
</g>
<!-- modm_platform_spi&#45;&gt;modm_cmsis_device -->
<g id="edge9" class="edge">
<title>modm_platform_spi&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M515.769,-50.1167C497.9365,-62.4198 476.1119,-77.4771 457.9033,-90.0396"/>
<polygon fill="#000000" stroke="#000000" points="455.5319,-87.4234 449.2884,-95.9832 459.5071,-93.1852 455.5319,-87.4234"/>
</g>
<!-- modm_platform_systick -->
<g id="node11" class="node">
<title>modm_platform_systick</title>
<g id="a_node11"><a xlink:href="../modm-platform-systick" xlink:title="modm:&#10;platform:&#10;systick">
<polygon fill="#d3d3d3" stroke="#000000" points="670,-53 602,-53 602,0 670,0 670,-53"/>
<text text-anchor="middle" x="636" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="636" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="636" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">systick</text>
</a>
</g>
</g>
<!-- modm_platform_systick&#45;&gt;modm_cmsis_device -->
<g id="edge10" class="edge">
<title>modm_platform_systick&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M601.6086,-48.5303C598.7351,-50.1138 595.842,-51.6257 593,-53 548.4837,-74.5269 494.5223,-92.9796 459.0539,-104.1396"/>
<polygon fill="#000000" stroke="#000000" points="457.6288,-100.9173 449.1179,-107.2272 459.7061,-107.6019 457.6288,-100.9173"/>
</g>
<!-- modm_platform_timer -->
<g id="node12" class="node">
<title>modm_platform_timer</title>
<g id="a_node12"><a xlink:href="../modm-platform-timer" xlink:title="modm:&#10;platform:&#10;timer">
<polygon fill="#d3d3d3" stroke="#000000" points="756,-53 688,-53 688,0 756,0 756,-53"/>
<text text-anchor="middle" x="722" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="722" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="722" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">timer</text>
</a>
</g>
</g>
<!-- modm_platform_timer&#45;&gt;modm_cmsis_device -->
<g id="edge11" class="edge">
<title>modm_platform_timer&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M687.7676,-48.8839C684.8584,-50.3881 681.9138,-51.7853 679,-53 604.182,-84.1913 510.3872,-102.0248 459.0076,-110.1321"/>
<polygon fill="#000000" stroke="#000000" points="458.3636,-106.6899 449.0124,-111.6705 459.4285,-113.6085 458.3636,-106.6899"/>
</g>
<!-- modm_platform_uart -->
<g id="node13" class="node">
<title>modm_platform_uart</title>
<g id="a_node13"><a xlink:href="../modm-platform-uart" xlink:title="modm:&#10;platform:&#10;uart">
<polygon fill="#d3d3d3" stroke="#000000" points="842,-53 774,-53 774,0 842,0 842,-53"/>
<text text-anchor="middle" x="808" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="808" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="808" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">uart</text>
</a>
</g>
</g>
<!-- modm_platform_uart&#45;&gt;modm_cmsis_device -->
<g id="edge12" class="edge">
<title>modm_platform_uart&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M773.8429,-49.072C770.9168,-50.5341 767.9478,-51.8702 765,-53 658.9617,-93.6429 524.1892,-108.2614 459.3122,-113.1867"/>
<polygon fill="#000000" stroke="#000000" points="458.8655,-109.7098 449.144,-113.922 459.3704,-116.6916 458.8655,-109.7098"/>
</g>
</g>
</svg>

