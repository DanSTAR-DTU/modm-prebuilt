!!! warning "These module docs are in beta and may be incomplete."

# modm:cmsis:device: STM32 CMSIS Headers

This module wraps [the CMSIS headers for STM32 devices][repo] and provides the
header file and CPP definitions for accessing the `modm:target` peripherals.
Specifically, it copies the target header file which provides the CMSIS
implementation of the target's language interface for its memory-mapped
peripherals.

!!! bug "Discrepancies between documentation and headers"
    These CMSIS headers should reflect what's written in the documentation,
    however, in our experience there may be small differences in naming,
    behavior and availability between it and this implementation.
    Since ST is not interested in addressing these issues, please contribute
	[to our patch list][patches].

The generated header file `modm/platform/device.hpp` contains the necessary
target define `STM32{FAMILY}{NAME}xx` or similar and includes the
`modm:target`-specific header.

!!! tip "Include only `modm/platform/device.hpp`!"
	This file is only included by interface implementations inside the
	`modm/platform` folder! If you need to implement your own drivers, include
	only this file.


## CMSIS Compliance

modm implements the target specific CMSIS functionality itself, without using
the CMSIS interface. This is necessary to provide similar functionality on
non-Cortex-M based targets.

Specifically, these functions are not implemented:

- `uint32_t SystemCoreClock` and `void SystemCoreClockUpdate()`: please use
  `modm::clock::f_cpu` as defined in the `modm:architecture:clock` module.
- `void SystemInit()`: modm defines its own startup architecture, see the
  `modm:platform:core` module for details.


[repo]: https://github.com/modm-io/cmsis-header-stm32
[patches]: https://github.com/modm-io/cmsis-header-stm32/tree/master/patches


## Debugging Peripherals

When debugging with GDB, it can sometimes be difficult to access peripherals,
due to the CMSIS implementation with CPP defines and GCC optimization flags.
Depending on these circumstances, GDB may only "see" a peripheral in a certain
context, which can make the debugging experience quite frustrating.

To aid this, we generate a linkerscript fragment and source file, which place
the peripherals memory as real objects in the peripheral memory space.
You can then access these peripherals inside GDB at any time, regardless of
context and build profile setting:

```
(gdb) p/x *GPIOB
$1 = {
  MODER = 0xaa0280,
  OTYPER = 0x300,
  OSPEEDR = 0x2a00c0,
  PUPDR = 0x400100,
  IDR = 0xfd0,
  ODR = 0x100,
  BSRR = 0x0,
  LCKR = 0x0,
  AFR = {0x0, 0x7744}
}
```

**This does not have any effect on your firmware!** It is purely a debug
helper feature and none of these definitions make it into the executable.

!!! tip "Beware read/write side-effects"
    When debugging be aware of the side-effects that your read or write to a
    peripheral memory location can have. It's fairly obvious that a write may
    have consequences, but also reads can modify peripheral state, for example,
    a hardware FIFO buffer may pop the queue if your read the top of it.

## Content

```cpp
// Define
#define STM32F446xx
```
## Queries
#### rcc-map

None
## Dependencies

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: modm:cmsis:device Pages: 1 -->
<svg width="936pt" height="239pt"
 viewBox="0.00 0.00 936.00 239.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 235)">
<title>modm:cmsis:device</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-235 932,-235 932,4 -4,4"/>
<!-- modm_cmsis_device -->
<g id="node1" class="node">
<title>modm_cmsis_device</title>
<polygon fill="#d3d3d3" stroke="#000000" stroke-width="2" points="492,-142 436,-142 436,-89 492,-89 492,-142"/>
<text text-anchor="middle" x="464" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="464" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="464" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#000000">device</text>
</g>
<!-- modm_cmsis -->
<g id="node2" class="node">
<title>modm_cmsis</title>
<g id="a_node2"><a xlink:href="../modm-cmsis" xlink:title="modm:&#10;cmsis">
<polygon fill="#d3d3d3" stroke="#000000" points="455,-223.5 399,-223.5 399,-185.5 455,-185.5 455,-223.5"/>
<text text-anchor="middle" x="427" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="427" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis -->
<g id="edge1" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis</title>
<path fill="none" stroke="#000000" d="M452.8988,-142.2029C448.4659,-152.8658 443.3545,-165.1608 438.8498,-175.9963"/>
<polygon fill="#000000" stroke="#000000" points="435.5274,-174.8708 434.9204,-185.4482 441.9911,-177.558 435.5274,-174.8708"/>
</g>
<!-- modm_cmsis_core -->
<g id="node3" class="node">
<title>modm_cmsis_core</title>
<g id="a_node3"><a xlink:href="../modm-cmsis-core" xlink:title="modm:&#10;cmsis:&#10;core">
<polygon fill="#d3d3d3" stroke="#000000" points="529,-231 473,-231 473,-178 529,-178 529,-231"/>
<text text-anchor="middle" x="501" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="501" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#000000">cmsis:</text>
<text text-anchor="middle" x="501" y="-185.8" font-family="Times,serif" font-size="14.00" fill="#000000">core</text>
</a>
</g>
</g>
<!-- modm_cmsis_device&#45;&gt;modm_cmsis_core -->
<g id="edge2" class="edge">
<title>modm_cmsis_device&#45;&gt;modm_cmsis_core</title>
<path fill="none" stroke="#000000" d="M475.1012,-142.2029C478.5403,-150.4753 482.3878,-159.73 486.0435,-168.5235"/>
<polygon fill="#000000" stroke="#000000" points="482.8359,-169.9257 489.9066,-177.8159 489.2996,-167.2385 482.8359,-169.9257"/>
</g>
<!-- modm_platform_adc -->
<g id="node4" class="node">
<title>modm_platform_adc</title>
<g id="a_node4"><a xlink:href="../modm-platform-adc" xlink:title="modm:&#10;platform:&#10;adc">
<polygon fill="#d3d3d3" stroke="#000000" points="68,-53 0,-53 0,0 68,0 68,-53"/>
<text text-anchor="middle" x="34" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="34" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="34" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">adc</text>
</a>
</g>
</g>
<!-- modm_platform_adc&#45;&gt;modm_cmsis_device -->
<g id="edge3" class="edge">
<title>modm_platform_adc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M68.1329,-49.1362C71.0644,-50.5838 74.0413,-51.8991 77,-53 198.9491,-98.375 354.5951,-110.8349 425.5914,-114.2355"/>
<polygon fill="#000000" stroke="#000000" points="425.6944,-117.7434 435.8399,-114.6908 426.0051,-110.7503 425.6944,-117.7434"/>
</g>
<!-- modm_platform_can -->
<g id="node5" class="node">
<title>modm_platform_can</title>
<g id="a_node5"><a xlink:href="../modm-platform-can" xlink:title="modm:&#10;platform:&#10;can">
<polygon fill="#d3d3d3" stroke="#000000" points="154,-53 86,-53 86,0 154,0 154,-53"/>
<text text-anchor="middle" x="120" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="120" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="120" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">can</text>
</a>
</g>
</g>
<!-- modm_platform_can&#45;&gt;modm_cmsis_device -->
<g id="edge4" class="edge">
<title>modm_platform_can&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M154.189,-48.9906C157.1079,-50.4709 160.0666,-51.8334 163,-53 253.1073,-88.8352 366.9301,-105.2861 425.4163,-111.8171"/>
<polygon fill="#000000" stroke="#000000" points="425.3571,-115.331 435.6748,-112.9236 426.1078,-108.3713 425.3571,-115.331"/>
</g>
<!-- modm_platform_cortex_m -->
<g id="node6" class="node">
<title>modm_platform_cortex_m</title>
<g id="a_node6"><a xlink:href="../modm-platform-cortex-m" xlink:title="modm:&#10;platform:&#10;cortex&#45;m">
<polygon fill="#d3d3d3" stroke="#000000" points="240,-53 172,-53 172,0 240,0 240,-53"/>
<text text-anchor="middle" x="206" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="206" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="206" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">cortex&#45;m</text>
</a>
</g>
</g>
<!-- modm_platform_cortex_m&#45;&gt;modm_cmsis_device -->
<g id="edge5" class="edge">
<title>modm_platform_cortex_m&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M240.2949,-48.7386C243.1901,-50.2754 246.1144,-51.7197 249,-53 308.3737,-79.3441 381.8425,-97.9261 425.7073,-107.6547"/>
<polygon fill="#000000" stroke="#000000" points="425.148,-111.1148 435.6638,-109.8232 426.6377,-104.2752 425.148,-111.1148"/>
</g>
<!-- modm_platform_fault -->
<g id="node7" class="node">
<title>modm_platform_fault</title>
<g id="a_node7"><a xlink:href="../modm-platform-fault" xlink:title="modm:&#10;platform:&#10;fault">
<polygon fill="#d3d3d3" stroke="#000000" points="326,-53 258,-53 258,0 326,0 326,-53"/>
<text text-anchor="middle" x="292" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="292" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="292" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">fault</text>
</a>
</g>
</g>
<!-- modm_platform_fault&#45;&gt;modm_cmsis_device -->
<g id="edge6" class="edge">
<title>modm_platform_fault&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M326.0832,-47.9352C329.0768,-49.6866 332.0785,-51.3974 335,-53 365.3144,-69.6292 400.721,-86.6176 426.7634,-98.6772"/>
<polygon fill="#000000" stroke="#000000" points="425.3602,-101.8843 435.9075,-102.8874 428.2879,-95.5259 425.3602,-101.8843"/>
</g>
<!-- modm_platform_gpio -->
<g id="node8" class="node">
<title>modm_platform_gpio</title>
<g id="a_node8"><a xlink:href="../modm-platform-gpio" xlink:title="modm:&#10;platform:&#10;gpio">
<polygon fill="#d3d3d3" stroke="#000000" points="412,-53 344,-53 344,0 412,0 412,-53"/>
<text text-anchor="middle" x="378" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="378" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="378" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">gpio</text>
</a>
</g>
</g>
<!-- modm_platform_gpio&#45;&gt;modm_cmsis_device -->
<g id="edge7" class="edge">
<title>modm_platform_gpio&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M403.8028,-53.2029C412.3916,-62.0913 422.0763,-72.1138 431.1264,-81.4797"/>
<polygon fill="#000000" stroke="#000000" points="428.7496,-84.0568 438.2154,-88.8159 433.7835,-79.1926 428.7496,-84.0568"/>
</g>
<!-- modm_platform_i2c -->
<g id="node9" class="node">
<title>modm_platform_i2c</title>
<g id="a_node9"><a xlink:href="../modm-platform-i2c" xlink:title="modm:&#10;platform:&#10;i2c">
<polygon fill="#d3d3d3" stroke="#000000" points="498,-53 430,-53 430,0 498,0 498,-53"/>
<text text-anchor="middle" x="464" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="464" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="464" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">i2c</text>
</a>
</g>
</g>
<!-- modm_platform_i2c&#45;&gt;modm_cmsis_device -->
<g id="edge8" class="edge">
<title>modm_platform_i2c&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M464,-53.2029C464,-61.2113 464,-70.1403 464,-78.6802"/>
<polygon fill="#000000" stroke="#000000" points="460.5001,-78.8159 464,-88.8159 467.5001,-78.8159 460.5001,-78.8159"/>
</g>
<!-- modm_platform_rcc -->
<g id="node10" class="node">
<title>modm_platform_rcc</title>
<g id="a_node10"><a xlink:href="../modm-platform-rcc" xlink:title="modm:&#10;platform:&#10;rcc">
<polygon fill="#d3d3d3" stroke="#000000" points="584,-53 516,-53 516,0 584,0 584,-53"/>
<text text-anchor="middle" x="550" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="550" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="550" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">rcc</text>
</a>
</g>
</g>
<!-- modm_platform_rcc&#45;&gt;modm_cmsis_device -->
<g id="edge9" class="edge">
<title>modm_platform_rcc&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M524.1972,-53.2029C515.6084,-62.0913 505.9237,-72.1138 496.8736,-81.4797"/>
<polygon fill="#000000" stroke="#000000" points="494.2165,-79.1926 489.7846,-88.8159 499.2504,-84.0568 494.2165,-79.1926"/>
</g>
<!-- modm_platform_spi -->
<g id="node11" class="node">
<title>modm_platform_spi</title>
<g id="a_node11"><a xlink:href="../modm-platform-spi" xlink:title="modm:&#10;platform:&#10;spi">
<polygon fill="#d3d3d3" stroke="#000000" points="670,-53 602,-53 602,0 670,0 670,-53"/>
<text text-anchor="middle" x="636" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="636" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="636" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">spi</text>
</a>
</g>
</g>
<!-- modm_platform_spi&#45;&gt;modm_cmsis_device -->
<g id="edge10" class="edge">
<title>modm_platform_spi&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M601.9168,-47.9352C598.9232,-49.6866 595.9215,-51.3974 593,-53 562.6856,-69.6292 527.279,-86.6176 501.2366,-98.6772"/>
<polygon fill="#000000" stroke="#000000" points="499.7121,-95.5259 492.0925,-102.8874 502.6398,-101.8843 499.7121,-95.5259"/>
</g>
<!-- modm_platform_systick -->
<g id="node12" class="node">
<title>modm_platform_systick</title>
<g id="a_node12"><a xlink:href="../modm-platform-systick" xlink:title="modm:&#10;platform:&#10;systick">
<polygon fill="#d3d3d3" stroke="#000000" points="756,-53 688,-53 688,0 756,0 756,-53"/>
<text text-anchor="middle" x="722" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="722" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="722" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">systick</text>
</a>
</g>
</g>
<!-- modm_platform_systick&#45;&gt;modm_cmsis_device -->
<g id="edge11" class="edge">
<title>modm_platform_systick&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M687.7051,-48.7386C684.8099,-50.2754 681.8856,-51.7197 679,-53 619.6263,-79.3441 546.1575,-97.9261 502.2927,-107.6547"/>
<polygon fill="#000000" stroke="#000000" points="501.3623,-104.2752 492.3362,-109.8232 502.852,-111.1148 501.3623,-104.2752"/>
</g>
<!-- modm_platform_timer -->
<g id="node13" class="node">
<title>modm_platform_timer</title>
<g id="a_node13"><a xlink:href="../modm-platform-timer" xlink:title="modm:&#10;platform:&#10;timer">
<polygon fill="#d3d3d3" stroke="#000000" points="842,-53 774,-53 774,0 842,0 842,-53"/>
<text text-anchor="middle" x="808" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="808" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="808" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">timer</text>
</a>
</g>
</g>
<!-- modm_platform_timer&#45;&gt;modm_cmsis_device -->
<g id="edge12" class="edge">
<title>modm_platform_timer&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M773.811,-48.9906C770.8921,-50.4709 767.9334,-51.8334 765,-53 674.8927,-88.8352 561.0699,-105.2861 502.5837,-111.8171"/>
<polygon fill="#000000" stroke="#000000" points="501.8922,-108.3713 492.3252,-112.9236 502.6429,-115.331 501.8922,-108.3713"/>
</g>
<!-- modm_platform_uart -->
<g id="node14" class="node">
<title>modm_platform_uart</title>
<g id="a_node14"><a xlink:href="../modm-platform-uart" xlink:title="modm:&#10;platform:&#10;uart">
<polygon fill="#d3d3d3" stroke="#000000" points="928,-53 860,-53 860,0 928,0 928,-53"/>
<text text-anchor="middle" x="894" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000">modm:</text>
<text text-anchor="middle" x="894" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">platform:</text>
<text text-anchor="middle" x="894" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000">uart</text>
</a>
</g>
</g>
<!-- modm_platform_uart&#45;&gt;modm_cmsis_device -->
<g id="edge13" class="edge">
<title>modm_platform_uart&#45;&gt;modm_cmsis_device</title>
<path fill="none" stroke="#000000" d="M859.8671,-49.1362C856.9356,-50.5838 853.9587,-51.8991 851,-53 729.0509,-98.375 573.4049,-110.8349 502.4086,-114.2355"/>
<polygon fill="#000000" stroke="#000000" points="501.9949,-110.7503 492.1601,-114.6908 502.3056,-117.7434 501.9949,-110.7503"/>
</g>
</g>
</svg>

